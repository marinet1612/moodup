<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–º–æ—â–Ω–∏–∫ –ø–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—é</title>
    <style>
        :root {
            --pink-light: #FFE5EC;
            --pink-medium: #FFB3C6;
            --pink-dark: #FF8FAB;
            --blue-light: #E0F4FF;
            --blue-medium: #A8D8EA;
            --blue-dark: #7AB8D4;
            --text-dark: #2C3E50;
            --white: #FFFFFF;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--pink-light) 0%, var(--blue-light) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-dark);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--pink-medium) 0%, var(--blue-medium) 100%);
            padding: 30px;
            text-align: center;
            color: var(--white);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(135deg, var(--pink-medium) 0%, var(--blue-medium) 100%);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px var(--shadow);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: linear-gradient(135deg, var(--blue-light) 0%, var(--pink-light) 100%);
            color: var(--text-dark);
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--blue-light);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--blue-medium);
        }

        .option-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .option-btn {
            padding: 10px 20px;
            background: var(--blue-light);
            border: 2px solid var(--blue-medium);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-btn.selected {
            background: var(--blue-medium);
            color: var(--white);
            border-color: var(--blue-dark);
        }

        .welcome-text {
            line-height: 1.8;
            margin: 20px 0;
        }

        .warning {
            background: #FFF3CD;
            border-left: 4px solid #FFC107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: var(--pink-light);
            border-radius: 10px;
        }

        canvas {
            max-width: 100%;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--pink-light) 0%, var(--blue-light) 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .stat-card h3 {
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .back-button {
            background: var(--blue-light);
            color: var(--text-dark);
            margin-top: 20px;
        }

        .questionnaire-step {
            display: none;
        }

        .questionnaire-step.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--blue-light);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--pink-medium), var(--blue-medium));
            transition: width 0.3s ease;
        }

        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .chat-container.open {
            display: flex;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--pink-medium), var(--blue-medium));
            color: var(--white);
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 24px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #F8F9FA;
        }

        .message {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
        }

        .message.user {
            background: var(--blue-light);
            margin-left: auto;
        }

        .message.bot {
            background: var(--pink-light);
        }

        .chat-input-container {
            padding: 15px;
            border-top: 1px solid #E0E0E0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--blue-light);
            border-radius: 8px;
            font-size: 14px;
        }

        .chat-send {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--pink-medium), var(--blue-medium));
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--pink-medium), var(--blue-medium));
            color: var(--white);
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px var(--shadow);
            z-index: 999;
        }

        .chat-toggle.hidden {
            display: none;
        }

        .custom-input {
            margin-top: 10px;
            display: none;
        }

        .custom-input.visible {
            display: block;
        }

        .disclaimer {
            background: #FFE5E5;
            border-left: 4px solid #FF6B6B;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .chat-container {
                width: calc(100% - 40px);
                height: 400px;
                bottom: 10px;
                right: 20px;
                left: 20px;
            }

            .chat-toggle {
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå∏ –¢–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—é üå∏</h1>
        </div>

        <div class="content">
            <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
            <div id="mainMenu" class="screen active">
                <div class="welcome-text">
                    <p><strong>–ü—Ä–∏–≤–µ—Ç! üôÇ</strong></p>
                    <p>–Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é.</p>
                    <p>–Ø –º–æ–≥—É –∑–∞–¥–∞–≤–∞—Ç—å —Ç–µ–±–µ –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ —Ç–æ–º, –∫–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å, –ø–æ–º–æ–≥–∞—Ç—å –∑–∞–º–µ—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–≤–æ—ë–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å, —á—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å —Ç–µ–±–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –ª—É—á—à–µ.</p>
                    <p>–°–æ –º–Ω–æ–π —É–¥–æ–±–Ω–æ –Ω–∞ –ø–∞—Ä—É –º–∏–Ω—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–µ–±—è –∏ —Å–≤–æ–∏ —á—É–≤—Å—Ç–≤–∞, –æ—Å–æ–∑–Ω–∞—Ç—å, —á—Ç–æ —Å —Ç–æ–±–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.</p>
                    <p>–ü–æ–ø—Ä–æ–±—É–π –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî –∏ —è –ø–æ–∫–∞–∂—É, –∫–∞–∫ –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω –∏–º–µ–Ω–Ω–æ —Ç–µ–±–µ üí¨</p>
                </div>

                <div class="warning">
                    ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> —è –Ω–µ –≤—Ä–∞—á –∏ –Ω–µ –∑–∞–º–µ–Ω—è—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.<br>
                    –ï—Å–ª–∏ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ —Ç–µ–±–µ –ø–ª–æ—Ö–æ –∏–ª–∏ –Ω—É–∂–Ω–∞ —Å–µ—Ä—å—ë–∑–Ω–∞—è –ø–æ–º–æ—â—å, –ª—É—á—à–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—É –∏–ª–∏ –≤—Ä–∞—á—É.
                </div>

                <button class="button" onclick="showScreen('profileScreen')">üë§ –û —Å–µ–±–µ</button>
                <button class="button" onclick="showScreen('questionnaireScreen')">üìù –ú–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
                <button class="button" onclick="showScreen('resultsScreen')">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç</button>
                <button class="button" onclick="showScreen('reminderScreen')">‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
                <button class="button" onclick="showScreen('helpScreen')">‚ùì –°–ø—Ä–∞–≤–∫–∞</button>
            </div>

            <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
            <div id="profileScreen" class="screen">
                <h2>üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
                <div class="input-group">
                    <label>–ò–º—è:</label>
                    <input type="text" id="profileName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                </div>
                <div class="input-group">
                    <label>–í–æ–∑—Ä–∞—Å—Ç:</label>
                    <input type="number" id="profileAge" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç">
                </div>
                <div class="input-group">
                    <label>–ü–æ–ª:</label>
                    <select id="profileGender">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>–§–æ—Ä–º–∞ –æ–±—â–µ–Ω–∏—è:</label>
                    <select id="profileTone">
                        <option value="—Ç—ã">–ù–∞ "—Ç—ã"</option>
                        <option value="–≤—ã">–ù–∞ "–í—ã"</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>–ú–µ–Ω—Ç–∞–ª—å–Ω—ã–µ/—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å):</label>
                    <textarea id="profileConditions" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ, –µ—Å–ª–∏ —Å—á–∏—Ç–∞–µ—Ç–µ –Ω—É–∂–Ω—ã–º..."></textarea>
                </div>
                <button class="button" onclick="saveProfile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                <button class="button back-button" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            </div>

            <!-- –û–ø—Ä–æ—Å–Ω–∏–∫ -->
            <div id="questionnaireScreen" class="screen">
                <h2>üìù –û–ø—Ä–æ—Å–Ω–∏–∫ –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 16.66%"></div>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 1 -->
                <div class="questionnaire-step active" data-step="1">
                    <h3 id="question1Text">–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?</h3>
                    <div class="option-buttons" id="moodOptions">
                        <div class="option-btn" data-value="–≤–µ—Å—ë–ª—ã–π">üòä –í–µ—Å—ë–ª—ã–π</div>
                        <div class="option-btn" data-value="–≥—Ä—É—Å—Ç–Ω—ã–π">üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π</div>
                        <div class="option-btn" data-value="–æ–∑–∞–¥–∞—á–µ–Ω–Ω—ã–π">ü§î –û–∑–∞–¥–∞—á–µ–Ω–Ω—ã–π</div>
                        <div class="option-btn" data-value="–∑–ª–æ–π">üò† –ó–ª–æ–π</div>
                        <div class="option-btn" data-value="—Ä–∞—Å—Ç–µ—Ä—è–Ω–Ω—ã–π">üòï –†–∞—Å—Ç–µ—Ä—è–Ω–Ω—ã–π</div>
                        <div class="option-btn" data-value="–≤–∑–±—É–¥–æ—Ä–∞–∂–µ–Ω–Ω—ã–π">üòÉ –í–∑–±—É–¥–æ—Ä–∞–∂–µ–Ω–Ω—ã–π</div>
                        <div class="option-btn" data-value="—Ç—Ä–µ–≤–æ–∂–Ω—ã–π">üò∞ –¢—Ä–µ–≤–æ–∂–Ω—ã–π</div>
                        <div class="option-btn" data-value="custom">‚úèÔ∏è –ù–∞–ø–∏—à—É —Å–∞–º</div>
                    </div>
                    <div class="custom-input" id="moodCustom">
                        <input type="text" id="moodCustomInput" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ...">
                    </div>
                    <button class="button" onclick="nextQuestion(2)">–î–∞–ª–µ–µ ‚Üí</button>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 2 -->
                <div class="questionnaire-step" data-step="2">
                    <h3>–°–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ —Ç—ã —Å–ø–∞–ª?</h3>
                    <div class="input-group">
                        <input type="number" id="sleepHours" min="0" max="24" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 7">
                    </div>
                    <button class="button" onclick="nextQuestion(3)">–î–∞–ª–µ–µ ‚Üí</button>
                    <button class="button button-secondary" onclick="prevQuestion(1)">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 3 -->
                <div class="questionnaire-step" data-step="3">
                    <h3>–ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –º–æ–≥–ª–∏ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ?</h3>
                    <div class="option-buttons" id="eventsOptions">
                        <div class="option-btn" data-value="–∞–ª–∫–æ–≥–æ–ª—å">üç∑ –ê–ª–∫–æ–≥–æ–ª—å</div>
                        <div class="option-btn" data-value="—Ç—è–∂—ë–ª–∞—è —Ä–∞–±–æ—Ç–∞">üíº –¢—è–∂—ë–ª–∞—è —Ä–∞–±–æ—Ç–∞</div>
                        <div class="option-btn" data-value="—Å—Å–æ—Ä–∞">üò§ –°—Å–æ—Ä–∞</div>
                        <div class="option-btn" data-value="—Å–ø–æ—Ä—Ç">üèÉ –°–ø–æ—Ä—Ç</div>
                        <div class="option-btn" data-value="–ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–µ–Ω—å">üõãÔ∏è –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–µ–Ω—å</div>
                        <div class="option-btn" data-value="–∑–¥–æ—Ä–æ–≤–∞—è –µ–¥–∞">ü•ó –ó–¥–æ—Ä–æ–≤–∞—è –µ–¥–∞</div>
                        <div class="option-btn" data-value="—Ç—è–∂—ë–ª–∞—è –µ–¥–∞">üçî –¢—è–∂—ë–ª–∞—è –µ–¥–∞</div>
                        <div class="option-btn" data-value="custom">‚úèÔ∏è –ù–∞–ø–∏—à—É —Å–∞–º</div>
                    </div>
                    <div class="custom-input" id="eventsCustom">
                        <input type="text" id="eventsCustomInput" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è...">
                    </div>
                    <button class="button" onclick="nextQuestion(4)">–î–∞–ª–µ–µ ‚Üí</button>
                    <button class="button button-secondary" onclick="prevQuestion(2)">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 4 -->
                <div class="questionnaire-step" data-step="4">
                    <h3 id="question4Text">–ö–∞–∫ –¥–µ–ª–∞ –Ω–∞ —É—á—ë–±–µ/—Ä–∞–±–æ—Ç–µ?</h3>
                    <div class="option-buttons" id="workOptions">
                        <div class="option-btn" data-value="–∑–∞–≥—Ä—É–∂–µ–Ω–æ">üìö –ó–∞–≥—Ä—É–∂–µ–Ω–æ</div>
                        <div class="option-btn" data-value="—Ç—è–∂–µ–ª–æ">üòì –¢—è–∂–µ–ª–æ</div>
                        <div class="option-btn" data-value="—Å–ø–æ–∫–æ–π–Ω–æ">üòå –°–ø–æ–∫–æ–π–Ω–æ</div>
                        <div class="option-btn" data-value="–≤—Å—ë –ª–µ–≥–∫–æ">üòé –í—Å—ë –ª–µ–≥–∫–æ</div>
                        <div class="option-btn" data-value="custom">‚úèÔ∏è –ù–∞–ø–∏—à—É —Å–∞–º</div>
                    </div>
                    <div class="custom-input" id="workCustom">
                        <input type="text" id="workCustomInput" placeholder="–û–ø–∏—à–∏—Ç–µ...">
                    </div>
                    <button class="button" onclick="nextQuestion(5)">–î–∞–ª–µ–µ ‚Üí</button>
                    <button class="button button-secondary" onclick="prevQuestion(3)">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 5 -->
                <div class="questionnaire-step" data-step="5">
                    <h3 id="question5Text">–ö–∞–∫ –¥–µ–ª–∞ –¥–æ–º–∞/–≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?</h3>
                    <div class="option-buttons" id="homeOptions">
                        <div class="option-btn" data-value="—Ö–æ—Ä–æ—à–æ">üòä –•–æ—Ä–æ—à–æ</div>
                        <div class="option-btn" data-value="–ø–ª–æ—Ö–æ">üòû –ü–ª–æ—Ö–æ</div>
                        <div class="option-btn" data-value="–Ω–µ —Ö–æ—á—É –æ—Ç–≤–µ—á–∞—Ç—å">ü§ê –ù–µ —Ö–æ—á—É –æ—Ç–≤–µ—á–∞—Ç—å</div>
                        <div class="option-btn" data-value="–≤—Å—ë —Å–ª–æ–∂–Ω–æ">üòî –í—Å—ë —Å–ª–æ–∂–Ω–æ</div>
                        <div class="option-btn" data-value="custom">‚úèÔ∏è –ù–∞–ø–∏—à—É —Å–∞–º</div>
                    </div>
                    <div class="custom-input" id="homeCustom">
                        <input type="text" id="homeCustomInput" placeholder="–û–ø–∏—à–∏—Ç–µ...">
                    </div>
                    <button class="button" onclick="nextQuestion(6)">–î–∞–ª–µ–µ ‚Üí</button>
                    <button class="button button-secondary" onclick="prevQuestion(4)">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 6 -->
                <div class="questionnaire-step" data-step="6">
                    <h3 id="question6Text">–ö–∞–∫ –±—ã —Ç—ã —Ö–æ—Ç–µ–ª —Å–µ–±—è —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å?</h3>
                    <div class="input-group">
                        <textarea id="desiredFeeling" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ..."></textarea>
                    </div>
                    <button class="button" onclick="checkPeriodQuestion()">–î–∞–ª–µ–µ ‚Üí</button>
                    <button class="button button-secondary" onclick="prevQuestion(5)">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <!-- –í–æ–ø—Ä–æ—Å 7 (—Ç–æ–ª—å–∫–æ –¥–ª—è –∂–µ–Ω—â–∏–Ω) -->
                <div class="questionnaire-step" data-step="7">
                    <h3>–ò–¥—É—Ç –ª–∏ —Å–µ–π—á–∞—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–Ω–∏?</h3>
                    <div class="option-buttons" id="periodOptions">
                        <div class="option-btn" data-value="–¥–∞">–î–∞</div>
                        <div class="option-btn" data-value="–Ω–µ—Ç">–ù–µ—Ç</div>
                    </div>
                    <button class="button" onclick="submitQuestionnaire()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–ø—Ä–æ—Å</button>
                    <button class="button button-secondary" onclick="prevQuestion(6)">‚Üê –ù–∞–∑–∞–¥</button>
                </div>

                <button class="button back-button" onclick="showScreen('mainMenu')">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div id="resultsScreen" class="screen">
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                <div class="option-buttons">
                    <button class="button" onclick="showCurrentAnalysis()">üîç –ê–Ω–∞–ª–∏–∑ —Å–µ–π—á–∞—Å</button>
                    <button class="button" onclick="showStatistics()">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>

                <div id="currentAnalysis" style="display: none;">
                    <h3>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                    <div class="stat-card" id="analysisResult"></div>
                    <div class="disclaimer">
                        ‚ö†Ô∏è <strong>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</strong> –î–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–æ—Å–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –í —Å–ª—É—á–∞–µ –∑–∞—Ç—è–∂–Ω–æ–≥–æ –ø–ª–æ—Ö–æ–≥–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è —Å–ª–µ–¥—É–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.
                    </div>
                </div>

                <div id="statisticsView" style="display: none;">
                    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</h3>
                    <div class="input-group">
                        <label>–ü–µ—Ä–∏–æ–¥:</label>
                        <select id="statsPeriod" onchange="updateStatistics()">
                            <option value="day">–î–µ–Ω—å</option>
                            <option value="week">–ù–µ–¥–µ–ª—è</option>
                            <option value="month">–ú–µ—Å—è—Ü</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="moodChart"></canvas>
                    </div>
                    <div id="statsComments"></div>
                </div>

                <button class="button back-button" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            </div>

            <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
            <div id="reminderScreen" class="screen">
                <h2>‚è∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</h2>
                <div class="input-group">
                    <label>–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:</label>
                    <input type="time" id="reminderTime">
                </div>
                <div class="input-group">
                    <label>–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å:</label>
                    <select id="reminderFrequency">
                        <option value="daily">–ö–∞–∂–¥—ã–π –¥–µ–Ω—å</option>
                        <option value="every2days">–ö–∞–∂–¥—ã–µ 2 –¥–Ω—è</option>
                        <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="reminderEnabled"> –í–∫–ª—é—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
                    </label>
                </div>
                <button class="button" onclick="saveReminder()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="button back-button" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            </div>

            <!-- –°–ø—Ä–∞–≤–∫–∞ -->
            <div id="helpScreen" class="screen">
                <h2>‚ùì –°–ø—Ä–∞–≤–∫–∞</h2>
                <div class="stat-card">
                    <h3>üë§ –û —Å–µ–±–µ</h3>
                    <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å: –∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –≤ –æ–±—â–µ–Ω–∏–∏.</p>
                </div>
                <div class="stat-card">
                    <h3>üìù –ú–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                    <p>–ü—Ä–æ–π–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø—Ä–æ—Å–Ω–∏–∫ –æ —Ç–µ–∫—É—â–µ–º —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏, —Å–Ω–µ –∏ —Å–æ–±—ã—Ç–∏—è—Ö –¥–Ω—è.</p>
                </div>
                <div class="stat-card">
                    <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                    <p>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.</p>
                </div>
                <div class="stat-card">
                    <h3>‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h3>
                    <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—Ä–µ–º—è –∏ —á–∞—Å—Ç–æ—Ç—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.</p>
                </div>
                <div class="stat-card">
                    <h3>üí¨ –ß–∞—Ç —Å –±–æ—Ç–æ–º</h3>
                    <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É —á–∞—Ç–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.</p>
                </div>
                <button class="button back-button" onclick="showScreen('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞ -->
    <button class="chat-toggle" id="chatToggle" onclick="toggleChat()">üí¨</button>

    <!-- –û–∫–Ω–æ —á–∞—Ç–∞ -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3>–ß–∞—Ç —Å –ø–æ–º–æ—â–Ω–∏–∫–æ–º</h3>
            <button class="chat-close" onclick="toggleChat()">√ó</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                –ü—Ä–∏–≤–µ—Ç! –Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏. –ó–∞–¥–∞–≤–∞–π –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã! üòä
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="chat-send" onclick="sendMessage()">üì§</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentQuestionnaireData = {};
        let moodChart = null;
        const OPENAI_API_KEY = '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';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            loadProfile();
            setupOptionButtons();
            checkReminder();
        };

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            if (screenId === 'questionnaireScreen') {
                resetQuestionnaire();
            }
        }

        // –ü—Ä–æ—Ñ–∏–ª—å
        function saveProfile() {
            const profile = {
                name: document.getElementById('profileName').value,
                age: document.getElementById('profileAge').value,
                gender: document.getElementById('profileGender').value,
                tone: document.getElementById('profileTone').value,
                conditions: document.getElementById('profileConditions').value
            };
            localStorage.setItem('userProfile', JSON.stringify(profile));
            alert('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
            updateQuestionsTone();
        }

        function loadProfile() {
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            if (profile.name) {
                document.getElementById('profileName').value = profile.name;
                document.getElementById('profileAge').value = profile.age || '';
                document.getElementById('profileGender').value = profile.gender || '';
                document.getElementById('profileTone').value = profile.tone || '—Ç—ã';
                document.getElementById('profileConditions').value = profile.conditions || '';
                updateQuestionsTone();
            }
        }

        function updateQuestionsTone() {
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            const tone = profile.tone || '—Ç—ã';
            
            if (tone === '–≤—ã') {
                document.getElementById('question1Text').textContent = '–ö–∞–∫ –í—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ?';
                document.getElementById('question4Text').textContent = '–ö–∞–∫ –¥–µ–ª–∞ –Ω–∞ —É—á—ë–±–µ/—Ä–∞–±–æ—Ç–µ?';
                document.getElementById('question5Text').textContent = '–ö–∞–∫ –¥–µ–ª–∞ –¥–æ–º–∞/–≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?';
                document.getElementById('question6Text').textContent = '–ö–∞–∫ –±—ã –í—ã —Ö–æ—Ç–µ–ª–∏ —Å–µ–±—è —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å?';
            } else {
                document.getElementById('question1Text').textContent = '–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?';
                document.getElementById('question4Text').textContent = '–ö–∞–∫ –¥–µ–ª–∞ –Ω–∞ —É—á—ë–±–µ/—Ä–∞–±–æ—Ç–µ?';
                document.getElementById('question5Text').textContent = '–ö–∞–∫ –¥–µ–ª–∞ –¥–æ–º–∞/–≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?';
                document.getElementById('question6Text').textContent = '–ö–∞–∫ –±—ã —Ç—ã —Ö–æ—Ç–µ–ª —Å–µ–±—è —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å?';
            }
        }

        // –û–ø—Ä–æ—Å–Ω–∏–∫
        function setupOptionButtons() {
            const optionGroups = ['moodOptions', 'eventsOptions', 'workOptions', 'homeOptions', 'periodOptions'];
            
            optionGroups.forEach(groupId => {
                const group = document.getElementById(groupId);
                if (!group) return;
                
                group.querySelectorAll('.option-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const value = this.dataset.value;
                        const customInputId = groupId.replace('Options', 'Custom');
                        
                        if (value === 'custom') {
                            const customDiv = document.getElementById(customInputId);
                            if (customDiv) {
                                customDiv.classList.toggle('visible');
                            }
                        }
                        
                        // –î–ª—è —Å–æ–±—ã—Ç–∏–π –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ
                        if (groupId === 'eventsOptions') {
                            this.classList.toggle('selected');
                        } else {
                            group.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                            this.classList.add('selected');
                        }
                    });
                });
            });
        }

        function resetQuestionnaire() {
            currentQuestionnaireData = {};
            document.querySelectorAll('.questionnaire-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector('[data-step="1"]').classList.add('active');
            document.getElementById('progressFill').style.width = '16.66%';
            
            // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–æ–≤
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.custom-input').forEach(input => input.classList.remove('visible'));
            document.getElementById('sleepHours').value = '';
            document.getElementById('desiredFeeling').value = '';
        }

        function nextQuestion(stepNumber) {
            const currentStep = stepNumber - 1;
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            if (currentStep === 1) {
                const selected = document.querySelector('#moodOptions .option-btn.selected');
                const customValue = document.getElementById('moodCustomInput').value;
                currentQuestionnaireData.mood = selected ? (selected.dataset.value === 'custom' ? customValue : selected.dataset.value) : '';
            } else if (currentStep === 2) {
                currentQuestionnaireData.sleep = document.getElementById('sleepHours').value;
            } else if (currentStep === 3) {
                const selected = Array.from(document.querySelectorAll('#eventsOptions .option-btn.selected'))
                    .map(btn => btn.dataset.value);
                const customValue = document.getElementById('eventsCustomInput').value;
                currentQuestionnaireData.events = selected.includes('custom') ? customValue : selected.join(', ');
            } else if (currentStep === 4) {
                const selected = document.querySelector('#workOptions .option-btn.selected');
                const customValue = document.getElementById('workCustomInput').value;
                currentQuestionnaireData.work = selected ? (selected.dataset.value === 'custom' ? customValue : selected.dataset.value) : '';
            } else if (currentStep === 5) {
                const selected = document.querySelector('#homeOptions .option-btn.selected');
                const customValue = document.getElementById('homeCustomInput').value;
                currentQuestionnaireData.home = selected ? (selected.dataset.value === 'custom' ? customValue : selected.dataset.value) : '';
            } else if (currentStep === 6) {
                currentQuestionnaireData.desired = document.getElementById('desiredFeeling').value;
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
            document.querySelectorAll('.questionnaire-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            const progress = (stepNumber / 7) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function prevQuestion(stepNumber) {
            document.querySelectorAll('.questionnaire-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
            
            const progress = (stepNumber / 7) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function checkPeriodQuestion() {
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            
            if (profile.gender === 'female') {
                nextQuestion(7);
            } else {
                submitQuestionnaire();
            }
        }

        function submitQuestionnaire() {
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            if (profile.gender === 'female') {
                const selected = document.querySelector('#periodOptions .option-btn.selected');
                currentQuestionnaireData.period = selected ? selected.dataset.value : '';
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–∏
            currentQuestionnaireData.timestamp = new Date().toISOString();
            currentQuestionnaireData.moodScore = calculateMoodScore(currentQuestionnaireData.mood);
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
            const history = JSON.parse(localStorage.getItem('moodHistory') || '[]');
            history.push(currentQuestionnaireData);
            localStorage.setItem('moodHistory', JSON.stringify(history));
            
            alert('‚úÖ –û–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à—ë–Ω! –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.');
            showScreen('mainMenu');
        }

        function calculateMoodScore(mood) {
            const positiveModds = ['–≤–µ—Å—ë–ª—ã–π', '–≤–∑–±—É–¥–æ—Ä–∞–∂–µ–Ω–Ω—ã–π', '—Å–ø–æ–∫–æ–π–Ω–æ', '–≤—Å—ë –ª–µ–≥–∫–æ', '—Ö–æ—Ä–æ—à–æ'];
            const negativeModds = ['–≥—Ä—É—Å—Ç–Ω—ã–π', '–∑–ª–æ–π', '—Ç—Ä–µ–≤–æ–∂–Ω—ã–π', '–ø–ª–æ—Ö–æ', '—Ç—è–∂–µ–ª–æ', '–≤—Å—ë —Å–ª–æ–∂–Ω–æ'];
            
            if (positiveModds.some(m => mood.toLowerCase().includes(m))) {
                return 1; // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ
            } else if (negativeModds.some(m => mood.toLowerCase().includes(m))) {
                return -1; // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ
            } else {
                return 0; // –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ
            }
        }

        // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∞–Ω–∞–ª–∏–∑
        async function showCurrentAnalysis() {
            document.getElementById('currentAnalysis').style.display = 'block';
            document.getElementById('statisticsView').style.display = 'none';
            
            const history = JSON.parse(localStorage.getItem('moodHistory') || '[]');
            if (history.length === 0) {
                document.getElementById('analysisResult').innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –ü—Ä–æ–π–¥–∏—Ç–µ –æ–ø—Ä–æ—Å!</p>';
                return;
            }
            
            const lastEntry = history[history.length - 1];
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            
            // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ LLM
            const analysisPrompt = `
–¢—ã –ø—Å–∏—Ö–æ–ª–æ–≥-–ø–æ–º–æ—â–Ω–∏–∫. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∞–π –∫—Ä–∞—Ç–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${lastEntry.mood}
- –°–æ–Ω: ${lastEntry.sleep} —á–∞—Å–æ–≤
- –°–æ–±—ã—Ç–∏—è: ${lastEntry.events}
- –†–∞–±–æ—Ç–∞/—É—á—ë–±–∞: ${lastEntry.work}
- –î–æ–º/–æ—Ç–Ω–æ—à–µ–Ω–∏—è: ${lastEntry.home}
- –ñ–µ–ª–∞–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ${lastEntry.desired}
${lastEntry.period ? `- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–Ω–∏: ${lastEntry.period}` : ''}

–ü—Ä–æ—Ñ–∏–ª—å:
${profile.conditions ? `- –ó–∞–±–æ–ª–µ–≤–∞–Ω–∏—è: ${profile.conditions}` : ''}

–î–∞–π –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑ (2-3 –∞–±–∑–∞—Ü–∞) –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∞ –Ω–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è.
`;

            try {
                document.getElementById('analysisResult').innerHTML = '<p>‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∞–Ω–Ω—ã–µ...</p>';
                const analysis = await callOpenAI(analysisPrompt);
                document.getElementById('analysisResult').innerHTML = `<p>${analysis.replace(/\n/g, '<br>')}</p>`;
            } catch (error) {
                document.getElementById('analysisResult').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∞–Ω–∞–ª–∏–∑–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.</p>';
                console.error(error);
            }
        }

        function showStatistics() {
            document.getElementById('currentAnalysis').style.display = 'none';
            document.getElementById('statisticsView').style.display = 'block';
            updateStatistics();
        }

        function updateStatistics() {
            const period = document.getElementById('statsPeriod').value;
            const history = JSON.parse(localStorage.getItem('moodHistory') || '[]');
            
            if (history.length === 0) {
                document.getElementById('statsComments').innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ü—Ä–æ–π–¥–∏—Ç–µ –æ–ø—Ä–æ—Å!</p>';
                return;
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥—É
            const now = new Date();
            let filteredHistory = history;
            
            if (period === 'day') {
                filteredHistory = history.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate.toDateString() === now.toDateString();
                });
            } else if (period === 'week') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredHistory = history.filter(entry => new Date(entry.timestamp) > weekAgo);
            } else if (period === 'month') {
                const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                filteredHistory = history.filter(entry => new Date(entry.timestamp) > monthAgo);
            }
            
            // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
            const labels = filteredHistory.map(entry => {
                const date = new Date(entry.timestamp);
                return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
            });
            
            const data = filteredHistory.map(entry => entry.moodScore);
            
            const ctx = document.getElementById('moodChart').getContext('2d');
            
            if (moodChart) {
                moodChart.destroy();
            }
            
            moodChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ',
                        data: data,
                        borderColor: '#FFB3C6',
                        backgroundColor: 'rgba(255, 179, 198, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            min: -1,
                            max: 1,
                            ticks: {
                                callback: function(value) {
                                    if (value === 1) return '–•–æ—Ä–æ—à–æ';
                                    if (value === 0) return '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ';
                                    if (value === -1) return '–ü–ª–æ—Ö–æ';
                                }
                            }
                        }
                    }
                }
            });
            
            // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            let comments = '<div class="stat-card"><h4>–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:</h4><ul>';
            filteredHistory.forEach(entry => {
                const date = new Date(entry.timestamp).toLocaleDateString('ru-RU');
                comments += `<li><strong>${date}:</strong> ${entry.mood} (—Å–æ–Ω: ${entry.sleep}—á, —Å–æ–±—ã—Ç–∏—è: ${entry.events})</li>`;
            });
            comments += '</ul></div>';
            
            document.getElementById('statsComments').innerHTML = comments;
        }

        // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        function saveReminder() {
            const reminder = {
                time: document.getElementById('reminderTime').value,
                frequency: document.getElementById('reminderFrequency').value,
                enabled: document.getElementById('reminderEnabled').checked
            };
            localStorage.setItem('reminder', JSON.stringify(reminder));
            alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            
            if (reminder.enabled) {
                scheduleReminder();
            }
        }

        function checkReminder() {
            const reminder = JSON.parse(localStorage.getItem('reminder') || '{}');
            if (reminder.enabled && reminder.time) {
                scheduleReminder();
            }
        }

        function scheduleReminder() {
            const reminder = JSON.parse(localStorage.getItem('reminder') || '{}');
            if (!reminder.enabled || !reminder.time) return;
            
            const now = new Date();
            const [hours, minutes] = reminder.time.split(':');
            const reminderTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
            
            if (reminderTime < now) {
                reminderTime.setDate(reminderTime.getDate() + 1);
            }
            
            const timeUntilReminder = reminderTime - now;
            
            setTimeout(() => {
                if (Notification.permission === 'granted') {
                    new Notification('üå∏ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏', {
                        body: '–î–∞–≤–∞–π —É–¥–µ–ª–∏–º –ø–∞—Ä—É –º–∏–Ω—É—Ç —Å–µ–±–µ –∏ –∑–∞–ø–æ–ª–Ω–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏!',
                        icon: 'üå∏'
                    });
                } else {
                    alert('üå∏ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –î–∞–≤–∞–π —É–¥–µ–ª–∏–º –ø–∞—Ä—É –º–∏–Ω—É—Ç —Å–µ–±–µ –∏ –∑–∞–ø–æ–ª–Ω–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏!');
                }
                
                // –ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
                scheduleReminder();
            }, timeUntilReminder);
        }

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // –ß–∞—Ç —Å LLM
        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            const chatToggle = document.getElementById('chatToggle');
            
            chatContainer.classList.toggle('open');
            chatToggle.classList.toggle('hidden');
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            addChatMessage(message, 'user');
            input.value = '';
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            const history = JSON.parse(localStorage.getItem('moodHistory') || '[]');
            const lastEntry = history.length > 0 ? history[history.length - 1] : null;
            
            // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            let context = `–¢—ã –∑–∞–±–æ—Ç–ª–∏–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é. `;
            if (profile.name) context += `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–æ–≤—É—Ç ${profile.name}. `;
            if (profile.tone) context += `–û–±—â–∞–π—Å—è –Ω–∞ "${profile.tone}". `;
            if (lastEntry) {
                context += `–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ - ${lastEntry.mood}, —Å–æ–Ω - ${lastEntry.sleep}—á. `;
            }
            context += `\n\n–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${message}\n\n–î–∞–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏. –ü–æ–º–Ω–∏, —á—Ç–æ —Ç—ã –Ω–µ –∑–∞–º–µ–Ω—è–µ—à—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –ø–æ–º–æ—â—å.`;
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ OpenAI
            try {
                addChatMessage('‚è≥ –ü–µ—á–∞—Ç–∞—é...', 'bot', 'typing');
                const response = await callOpenAI(context);
                document.querySelector('.message.typing').remove();
                addChatMessage(response, 'bot');
            } catch (error) {
                document.querySelector('.message.typing')?.remove();
                addChatMessage('‚ùå –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'bot');
                console.error(error);
            }
        }

        function addChatMessage(text, sender, className = '') {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender} ${className}`;
            messageDiv.textContent = text;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function callOpenAI(prompt) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${OPENAI_API_KEY}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [
                        {
                            role: 'system',
                            content: '–¢—ã –∑–∞–±–æ—Ç–ª–∏–≤—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é. –î–∞–≤–∞–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ, —ç–º–ø–∞—Ç–∏—á–Ω—ã–µ –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ —Å–æ–≤–µ—Ç—ã. –í—Å–µ–≥–¥–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–π, —á—Ç–æ –Ω–µ –∑–∞–º–µ–Ω—è–µ—à—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –ø–æ–º–æ—â—å –ø—Ä–∏ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 500
                })
            });

            if (!response.ok) {
                throw new Error('OpenAI API error');
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }
    </script>
</body>
</html>
